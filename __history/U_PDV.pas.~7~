unit U_PDV;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.ComCtrls, Data.DB, Vcl.StdCtrls,
  Vcl.Grids, Vcl.DBGrids, Vcl.ExtCtrls;

type
  TF_PDV = class(TForm)
    StatusBar1: TStatusBar;
    pnl_pdv_baixo: TPanel;
    dbg_lancamento: TDBGrid;
    edt_pro_descr: TEdit;
    edt_pro_preco: TEdit;
    edt_pro_qtd: TEdit;
    btn_pro_add: TButton;
    edt_total: TEdit;
    Label1: TLabel;
    btn_gravar_venda: TButton;
    btn_cancelar_venda: TButton;
    btn_remove_item: TButton;
    edt_cli_codigo: TEdit;
    edt_cli_nome: TEdit;
    edt_pro_cod: TEdit;
    btn_iniciar_venda: TButton;
    desc: TLabel;
    procedure edt_cli_codigoKeyPress(Sender: TObject; var Key: Char);
    procedure edt_pro_codKeyPress(Sender: TObject; var Key: Char);
    procedure BloqueiaCampos;
    procedure FormCreate(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  F_PDV: TF_PDV;

implementation

{$R *.dfm}

uses DM, U_Funcoes;

procedure BloqueiaCampos;
begin
  //bloqueia os campos até que se inicie a venda
  edt_pro_descr.enable := false;
  edt_pro_preco.enable := false;
  edt_pro_cod.enable := false;
  edt_pro_qtd.enable := false;

end;

procedure TF_PDV.edt_cli_codigoKeyPress(Sender: TObject; var Key: Char);
begin
  if key = #13 then
  begin
    with DataMod.QRY_Cli do
     begin
       close;
       SQL.clear;
       SQL.add('select * from clientes ');
       SQL.add(' where Codigo = :codigo ');
       ParamByName('codigo').value :=  edt_cli_codigo.text;
       open;

       if recordcount = 0 then
       begin
         showMessage('Cliente não encontrado');
         edt_cli_nome.clear;
         edt_cli_codigo.clear;
       end
       else if recordcount = 1 then
       begin
         edt_cli_nome.text := dataMod.QRY_cliNome.AsString;
       end;




     end;

  end;

end;

procedure TF_PDV.edt_pro_codKeyPress(Sender: TObject; var Key: Char);
begin
  if key = #13 then
  begin
    with DataMod.QRY_Prod do
     begin
       close;
       SQL.clear;
       SQL.add('select * from produtos ');
       SQL.add(' where Codigo = :codigo ');
       ParamByName('codigo').value :=  edt_pro_cod.text;
       open;

       if recordcount = 0 then
       begin
         showMessage('Produto não encontrado');
         edt_pro_descr.clear;
         edt_pro_preco.clear;
         edt_pro_cod.clear;
       end
       else if recordcount = 1 then
       begin
         edt_pro_descr.text := dataMod.QRY_ProdDescricao.AsString;
         edt_pro_preco.text := dataMod.QRY_ProdPrecoVenda.AsString;
         edt_pro_qtd.SetFocus;
       end;




     end;
  end;

end;

procedure TF_PDV.FormCreate(Sender: TObject);
begin
  BloqueiaCampos;
end;

end.
